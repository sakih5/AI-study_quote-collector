# ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§ãƒ‡ãƒ¼ã‚¿ãŒã©ã®ã‚ˆã†ã«æµã‚Œã‚‹ã‹ã‚’å­¦ã³ã¾ã™ã€‚

---

## ğŸŒŠ å…¨ä½“ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼     â”‚  1. ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
â”‚ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js     â”‚  2. ç”»é¢ã‚’è¡¨ç¤ºã€ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦
â”‚ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆ    â”‚     app/(main)/page.tsx
â”‚  ã‚¨ãƒ³ãƒ‰ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
       â”‚    fetch('/api/quotes')
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Routes  â”‚  4. ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†
â”‚ï¼ˆãƒãƒƒã‚¯      â”‚     app/api/quotes/route.ts
â”‚  ã‚¨ãƒ³ãƒ‰ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¯ã‚¨ãƒª
       â”‚    supabase.from('quotes')
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase    â”‚  6. ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
â”‚ï¼ˆãƒ‡ãƒ¼ã‚¿      â”‚
â”‚  ãƒ™ãƒ¼ã‚¹ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Routes  â”‚  8. JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js     â”‚  9. ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ã¦ç”»é¢æ›´æ–°
â”‚ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆ    â”‚
â”‚  ã‚¨ãƒ³ãƒ‰ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼     â”‚  10. æ›´æ–°ã•ã‚ŒãŸç”»é¢ã‚’è¦‹ã‚‹
â”‚ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“– å…·ä½“ä¾‹ï¼šãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ›ãƒ¼ãƒ ç”»é¢ã‚’é–‹ã

URL: `https://example.com/`

â†“

Next.jsãŒ `app/(main)/page.tsx` ã‚’å®Ÿè¡Œ

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚

```typescript
// app/(main)/page.tsx
export default function HomePage() {
  // ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
  const { items, loading, error } = useQuotesGrouped();

  if (loading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;
  if (error) return <div>ã‚¨ãƒ©ãƒ¼: {error}</div>;

  return (
    <div>
      {items.map(item => (
        <QuoteGroupCard key={item.id} item={item} />
      ))}
    </div>
  );
}
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ãŒAPIã‚’å‘¼ã³å‡ºã™

```typescript
// app/(main)/hooks/useQuotesGrouped.ts
export function useQuotesGrouped() {
  const [items, setItems] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // APIã‚’å‘¼ã³å‡ºã™
    fetch('/api/quotes/grouped')
      .then(res => res.json())
      .then(data => {
        setItems(data);
        setLoading(false);
      });
  }, []);

  return { items, loading };
}
```

### ã‚¹ãƒ†ãƒƒãƒ—4: APIãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†

```typescript
// app/api/quotes/grouped/route.ts
export async function GET(request: Request) {
  // èªè¨¼ãƒã‚§ãƒƒã‚¯
  const supabase = createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    return Response.json({ error: 'æœªèªè¨¼' }, { status: 401 });
  }

  // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
  const { data: quotes } = await supabase
    .from('quotes_with_details')  // ãƒ“ãƒ¥ãƒ¼
    .select('*')
    .eq('user_id', user.id)
    .order('created_at', { ascending: false });

  // ã‚°ãƒ«ãƒ¼ãƒ—åŒ–å‡¦ç†
  const grouped = groupQuotesBySource(quotes);

  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
  return Response.json(grouped);
}
```

### ã‚¹ãƒ†ãƒƒãƒ—5: SupabaseãŒãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™

```sql
-- PostgreSQLã‚¯ã‚¨ãƒªï¼ˆå®Ÿéš›ã«ã¯SupabaseãŒå®Ÿè¡Œï¼‰
SELECT * FROM quotes_with_details
WHERE user_id = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID'
ORDER BY created_at DESC;
```

### ã‚¹ãƒ†ãƒƒãƒ—6: ãƒ‡ãƒ¼ã‚¿ãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹

```
quotes_with_details
â†“
API (/api/quotes/grouped)
â†“
useQuotesGrouped ãƒ•ãƒƒã‚¯
â†“
HomePage ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â†“
QuoteGroupCard ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â†“
ãƒ–ãƒ©ã‚¦ã‚¶ã«è¡¨ç¤º
```

---

## âœï¸ å…·ä½“ä¾‹ï¼šãƒ•ãƒ¬ãƒ¼ã‚ºã‚’ç™»éŒ²ã™ã‚‹

### å…¨ä½“ã®æµã‚Œ

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
â†“
QuoteModalï¼ˆãƒ•ã‚©ãƒ¼ãƒ ï¼‰
â†“
POST /api/quotesï¼ˆAPIå‘¼ã³å‡ºã—ï¼‰
â†“
app/api/quotes/route.tsï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ + DBä¿å­˜ï¼‰
â†“
Supabaseï¼ˆINSERTæ–‡å®Ÿè¡Œï¼‰
â†“
æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
â†“
ç”»é¢æ›´æ–°ï¼ˆæ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’è¡¨ç¤ºï¼‰
```

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¢ãƒ¼ãƒ€ãƒ«ã§å…¥åŠ›

```typescript
// app/(main)/components/QuoteModal.tsx
'use client';
import { useState } from 'react';

export default function QuoteModal() {
  const [text, setText] = useState('');
  const [activityIds, setActivityIds] = useState<number[]>([]);
  const [tagIds, setTagIds] = useState<number[]>([]);

  const handleSubmit = async () => {
    // APIã«é€ä¿¡
    const response = await fetch('/api/quotes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        quotes: [{
          text,
          activity_ids: activityIds,
          tag_ids: tagIds,
        }],
      }),
    });

    if (response.ok) {
      alert('ç™»éŒ²ã—ã¾ã—ãŸï¼');
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      onClose();
      // ä¸€è¦§ã‚’æ›´æ–°
      refetch();
    }
  };

  return (
    <div>
      <input value={text} onChange={(e) => setText(e.target.value)} />
      {/* æ´»å‹•é ˜åŸŸã€ã‚¿ã‚°é¸æŠ */}
      <button onClick={handleSubmit}>ç™»éŒ²</button>
    </div>
  );
}
```

### ã‚¹ãƒ†ãƒƒãƒ—2: APIãŒãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹

```typescript
// app/api/quotes/route.ts
export async function POST(request: Request) {
  // 1. èªè¨¼ãƒã‚§ãƒƒã‚¯
  const supabase = createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    return Response.json({ error: 'æœªèªè¨¼' }, { status: 401 });
  }

  // 2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’å–å¾—
  const body = await request.json();
  const { quotes } = body;

  // 3. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  if (!quotes || quotes.length === 0) {
    return Response.json({ error: 'ãƒ•ãƒ¬ãƒ¼ã‚ºãŒç©ºã§ã™' }, { status: 400 });
  }

  // 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
  const quotesToInsert = quotes.map(q => ({
    user_id: user.id,
    text: q.text,
    source_type: q.source_type || 'OTHER',
    // ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  }));

  const { data, error } = await supabase
    .from('quotes')
    .insert(quotesToInsert)
    .select();

  if (error) {
    return Response.json({ error: error.message }, { status: 500 });
  }

  // 5. é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ï¼ˆquote_activities, quote_tagsï¼‰
  // ...çœç•¥...

  // 6. æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
  return Response.json({ success: true, data });
}
```

### ã‚¹ãƒ†ãƒƒãƒ—3: SupabaseãŒãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜

```sql
-- PostgreSQLï¼ˆSupabaseãŒå®Ÿè¡Œï¼‰
INSERT INTO quotes (user_id, text, source_type, created_at)
VALUES ('ãƒ¦ãƒ¼ã‚¶ãƒ¼ID', 'ãƒ•ãƒ¬ãƒ¼ã‚ºå†…å®¹', 'OTHER', NOW())
RETURNING *;

-- é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«
INSERT INTO quote_activities (quote_id, activity_id)
VALUES (1, 1), (1, 2);

INSERT INTO quote_tags (quote_id, tag_id)
VALUES (1, 5);
```

---

## ğŸ” èªè¨¼ã®æµã‚Œ

### ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
2. Supabase Authã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   â†“
3. Googleã®èªè¨¼ç”»é¢
   â†“
4. èªè¨¼æˆåŠŸå¾Œã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   /auth/callback
   â†“
5. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’Cookieã«ä¿å­˜
   â†“
6. ãƒ›ãƒ¼ãƒ ç”»é¢ï¼ˆ/ï¼‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```

### å®Ÿè£…ã‚³ãƒ¼ãƒ‰

**ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢**ï¼ˆ`app/(auth)/login/page.tsx`ï¼‰
```typescript
'use client';
import { createClient } from '@/lib/supabase/client';

export default function LoginPage() {
  const supabase = createClient();

  const handleGoogleLogin = async () => {
    await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}/auth/callback`,
      },
    });
  };

  return (
    <button onClick={handleGoogleLogin}>
      Googleã§ãƒ­ã‚°ã‚¤ãƒ³
    </button>
  );
}
```

**ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†**ï¼ˆ`app/auth/callback/route.ts`ï¼‰
```typescript
import { createClient } from '@/lib/supabase/server';
import { NextResponse } from 'next/server';

export async function GET(request: Request) {
  const requestUrl = new URL(request.url);
  const code = requestUrl.searchParams.get('code');

  if (code) {
    const supabase = createClient();
    await supabase.auth.exchangeCodeForSession(code);
  }

  // ãƒ›ãƒ¼ãƒ ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  return NextResponse.redirect(new URL('/', requestUrl.origin));
}
```

**ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**ï¼ˆ`middleware.ts`ï¼‰
```typescript
import { createServerClient } from '@supabase/ssr';
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export async function middleware(request: NextRequest) {
  let response = NextResponse.next();

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return request.cookies.get(name)?.value;
        },
        set(name: string, value: string, options: any) {
          response.cookies.set({ name, value, ...options });
        },
        remove(name: string, options: any) {
          response.cookies.set({ name, value: '', ...options });
        },
      },
    }
  );

  const { data: { user } } = await supabase.auth.getUser();

  // æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’/loginã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  if (!user && !request.nextUrl.pathname.startsWith('/login')) {
    return NextResponse.redirect(new URL('/login', request.url));
  }

  // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ/loginã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰/ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  if (user && request.nextUrl.pathname === '/login') {
    return NextResponse.redirect(new URL('/', request.url));
  }

  return response;
}
```

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã¨ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

```
quotes (ãƒ•ãƒ¬ãƒ¼ã‚º)
â”œâ”€â”€ id
â”œâ”€â”€ user_id          â†’ users.id
â”œâ”€â”€ text
â”œâ”€â”€ source_type
â”œâ”€â”€ book_id          â†’ books.id
â”œâ”€â”€ sns_user_id      â†’ sns_users.id
â””â”€â”€ created_at

books (æ›¸ç±)
â”œâ”€â”€ id
â”œâ”€â”€ user_id          â†’ users.id
â”œâ”€â”€ title
â”œâ”€â”€ author
â””â”€â”€ created_at

tags (ã‚¿ã‚°)
â”œâ”€â”€ id
â”œâ”€â”€ user_id          â†’ users.id
â”œâ”€â”€ name
â””â”€â”€ created_at

activities (æ´»å‹•é ˜åŸŸ)
â”œâ”€â”€ id
â”œâ”€â”€ name
â””â”€â”€ icon

quote_activities (å¤šå¯¾å¤š)
â”œâ”€â”€ quote_id         â†’ quotes.id
â””â”€â”€ activity_id      â†’ activities.id

quote_tags (å¤šå¯¾å¤š)
â”œâ”€â”€ quote_id         â†’ quotes.id
â””â”€â”€ tag_id           â†’ tags.id
```

### ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾‹

**1ã¤ã®ãƒ•ãƒ¬ãƒ¼ã‚ºã«å¯¾ã—ã¦**:
- è¤‡æ•°ã®æ´»å‹•é ˜åŸŸï¼ˆ`quote_activities`ãƒ†ãƒ¼ãƒ–ãƒ«ã§é–¢é€£ä»˜ã‘ï¼‰
- è¤‡æ•°ã®ã‚¿ã‚°ï¼ˆ`quote_tags`ãƒ†ãƒ¼ãƒ–ãƒ«ã§é–¢é€£ä»˜ã‘ï¼‰
- 1ã¤ã®æ›¸ç±ã¾ãŸã¯SNSãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰

```sql
-- ãƒ•ãƒ¬ãƒ¼ã‚ºã¨é–¢é€£ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
SELECT
  q.*,
  b.title AS book_title,
  b.author AS book_author,
  array_agg(DISTINCT a.name) AS activities,
  array_agg(DISTINCT t.name) AS tags
FROM quotes q
LEFT JOIN books b ON q.book_id = b.id
LEFT JOIN quote_activities qa ON q.id = qa.quote_id
LEFT JOIN activities a ON qa.activity_id = a.id
LEFT JOIN quote_tags qt ON q.id = qt.quote_id
LEFT JOIN tags t ON qt.tag_id = t.id
WHERE q.user_id = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ID'
GROUP BY q.id, b.id;
```

ã“ã®ã‚¯ã‚¨ãƒªã¯**ãƒ“ãƒ¥ãƒ¼**ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™:
```sql
CREATE VIEW quotes_with_details AS ...
```

APIã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ç”¨:
```typescript
const { data } = await supabase
  .from('quotes_with_details')
  .select('*');
```

---

## ğŸ”„ çŠ¶æ…‹ç®¡ç†ã®æµã‚Œ

### React Hooksã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€è¤‡é›‘ãªçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆReduxç­‰ï¼‰ã¯ä½¿ã‚ãšã€**React Hooks**ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

#### useStateã®ä¾‹

```typescript
'use client';
import { useState } from 'react';

function Counter() {
  // state: ç¾åœ¨ã®å€¤
  // setState: å€¤ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>ã‚«ã‚¦ãƒ³ãƒˆ: {count}</p>
      <button onClick={() => setCount(count + 1)}>+1</button>
    </div>
  );
}
```

**ãƒ•ãƒ­ãƒ¼**:
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. `setCount(count + 1)` ãŒå®Ÿè¡Œ
3. `count` ãŒæ›´æ–°ã•ã‚Œã‚‹
4. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
5. æ–°ã—ã„å€¤ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### useEffectã®ä¾‹ï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰

```typescript
'use client';
import { useState, useEffect } from 'react';

function QuoteList() {
  const [quotes, setQuotes] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œ
    fetch('/api/quotes')
      .then(res => res.json())
      .then(data => {
        setQuotes(data);
        setLoading(false);
      });
  }, []); // ç©ºé…åˆ— = åˆå›ã®ã¿å®Ÿè¡Œ

  if (loading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;

  return (
    <ul>
      {quotes.map(q => <li key={q.id}>{q.text}</li>)}
    </ul>
  );
}
```

**ãƒ•ãƒ­ãƒ¼**:
1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆï¼ˆç”»é¢ã«è¡¨ç¤ºï¼‰
2. `useEffect` å†…ã®å‡¦ç†ãŒå®Ÿè¡Œ
3. APIã‚’å‘¼ã³å‡ºã—
4. ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
5. `setQuotes(data)` ã§stateã‚’æ›´æ–°
6. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
7. ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

## ğŸ¨ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ

### Propsï¼ˆè¦ªâ†’å­ï¼‰

```typescript
// è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function ParentComponent() {
  const data = { id: 1, name: "å¤ªéƒ" };

  return <ChildComponent user={data} />;
}

// å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function ChildComponent({ user }: { user: { id: number; name: string } }) {
  return <div>ã“ã‚“ã«ã¡ã¯ã€{user.name}ã•ã‚“</div>;
}
```

**ãƒ•ãƒ­ãƒ¼**:
```
ParentComponent (data)
    â†“ props
ChildComponent (user)
    â†“
ç”»é¢ã«è¡¨ç¤º
```

### ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå­â†’è¦ªï¼‰

```typescript
// è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function ParentComponent() {
  const [count, setCount] = useState(0);

  const handleIncrement = () => {
    setCount(count + 1);
  };

  return (
    <div>
      <p>ã‚«ã‚¦ãƒ³ãƒˆ: {count}</p>
      <ChildComponent onIncrement={handleIncrement} />
    </div>
  );
}

// å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function ChildComponent({ onIncrement }: { onIncrement: () => void }) {
  return <button onClick={onIncrement}>+1</button>;
}
```

**ãƒ•ãƒ­ãƒ¼**:
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    â†“
ChildComponent ã® onClick
    â†“
onIncrement() ã‚’å‘¼ã³å‡ºã—
    â†“
ParentComponent ã® handleIncrement å®Ÿè¡Œ
    â†“
setCount(count + 1)
    â†“
ParentComponent ãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    â†“
æ–°ã—ã„countãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

---

## âœ… ã¾ã¨ã‚

### ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ

1. **è¡¨ç¤º**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ ç”»é¢ â†’ API â†’ DB â†’ ç”»é¢ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼
2. **ç™»éŒ²**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ ãƒ•ã‚©ãƒ¼ãƒ  â†’ API â†’ DB â†’ æˆåŠŸ â†’ ç”»é¢æ›´æ–°

### ä¸»è¦ãªæŠ€è¡“

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React Hooksï¼ˆuseState, useEffectï¼‰
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Next.js API Routes
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase (PostgreSQL)
- **èªè¨¼**: Supabase Auth

### ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

- **page.tsx**: ç”»é¢ã‚’è¡¨ç¤º
- **hooks/*.ts**: ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯
- **api/*/route.ts**: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **lib/supabase/**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ‡ãƒ¼ã‚¿ã®æµã‚ŒãŒç†è§£ã§ããŸã‚‰ã€æ¬¡ã¯**å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’1ã¤ãšã¤èª­ã¿è§£ã„ã¦**ã„ãã¾ã—ã‚‡ã†ï¼

æ¨å¥¨é †åº:
1. å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`lib/supabase/types.ts`ï¼‰
2. ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`app/(main)/components/Header.tsx`ï¼‰
3. APIãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`app/api/activities/route.ts`ï¼‰
4. ç”»é¢ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`app/(main)/page.tsx`ï¼‰

---

**å‚è€ƒãƒªãƒ³ã‚¯**:
- [React Hooks](https://react.dev/reference/react)
- [Next.js Data Fetching](https://nextjs.org/docs/app/building-your-application/data-fetching)
- [Supabase JavaScript Client](https://supabase.com/docs/reference/javascript)
