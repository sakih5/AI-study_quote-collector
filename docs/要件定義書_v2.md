# 要件定義書 v2.0

## 1. プロジェクト概要

### 1.1 プロダクト名

**抜き書きアプリ**（仮称）

### 1.2 目的

本、SNS投稿、その他の情報源から得た重要なフレーズを記録・整理し、活動領域やタグで分類することで、後から振り返りやすくする個人用ナレッジベースアプリ。

### 1.3 ターゲットユーザー

- 読書家
- 情報収集を習慣化したい人
- SNSから学びを得ている人
- 自己成長・知識管理に関心がある人

---

## 2. 機能要件

### 2.1 ユーザー管理

#### 2.1.1 認証機能

- **ログイン/ログアウト**
  - Supabase Authを使用
  - 対応プロバイダー：Google, GitHub, Email（Magic Link）
- **アカウント削除**
  - 設定画面から削除可能
  - 削除時はすべてのデータも削除（論理削除）

### 2.2 フレーズ管理

#### 2.2.1 フレーズ登録

- **入力方法**
  - テキスト直接入力
  - 画像からOCR抽出（なぞり選択）
- **登録項目**
  - フレーズ本文（必須）
  - 活動領域（複数選択可、必須）
  - タグ（複数選択可、任意）
  - 出典情報（必須）
- **一括登録**
  - [+]ボタンで同じ出典から複数フレーズを一度に登録可能
  - 各フレーズに個別の活動領域・タグを設定可能

#### 2.2.2 出典タイプ

1. **本**
   - AmazonのURLから自動取得
     - タイトル
     - 著者
     - 書籍カバー画像
   - 取得失敗時は手動入力可能
   - 既存の書籍から選択も可能

2. **SNS（X / Threads）**
   - 投稿URLから自動取得
     - ユーザーID（@username）
     - ユーザー名（表示名）
   - プラットフォーム選択：X / Threads
   - 既存のユーザーから選択も可能

3. **その他**
   - 出典（任意）：自由記述
   - メモ（任意）：自由記述

#### 2.2.3 フレーズ表示・検索

- **ホーム画面**
  - 書籍単位・SNSユーザー単位でグループ化表示
  - 無限スクロール
  - キーワード検索（フレーズ本文、出典を対象）
  - 活動領域フィルター（複数選択可）
  - タグフィルター（複数選択可）
  - 該当件数表示
  - 登録日時表示

- **表示内容**
  - 書籍の場合：
    - 書籍カバー画像
    - タイトル・著者
    - フレーズ一覧
    - ページ番号（任意）
    - 活動領域（絵文字付き）
    - タグ
    - 登録日時

  - SNSの場合：
    - SNSアイコン（X/Threads）
    - ユーザー名・ユーザーID
    - フレーズ一覧
    - 活動領域（絵文字付き）
    - タグ
    - 登録日時

#### 2.2.4 フレーズ編集・削除

- ホーム画面から直接編集・削除可能
- 削除は論理削除

#### 2.2.5 CSVエクスポート

- 検索・フィルター結果をCSVでエクスポート
- 出力項目：
  - フレーズ
  - 出典
  - 活動領域
  - タグ
  - 登録日時

### 2.3 活動領域管理

#### 2.3.1 活動領域の定義

システムで固定の10個の活動領域：

| ID | 領域名 | 説明 | アイコン |
|----|--------|------|---------|
| 1 | 仕事・キャリア | 業務、スキル開発、キャリア形成に関連する活動 | 💼 |
| 2 | 学習・研究 | 勉強、調査、知識習得に関する活動 | 📖 |
| 3 | 創作・制作活動 | 執筆、プログラミング、デザイン、工作等 | 🎨 |
| 4 | 趣味・娯楽 | ゲーム、音楽鑑賞、映画、コレクション等 | 🎮 |
| 5 | 運動・身体活動 | スポーツ、トレーニング、散歩等 | 🏃 |
| 6 | 読書・情報収集 | 本、記事、SNS、ニュース等の閲覧 | 📚 |
| 7 | 人間関係・コミュニケーション | 家族、友人、同僚との関わり | 👥 |
| 8 | 生活習慣・セルフケア | 睡眠、食事、メンタルケア、環境整備 | 🌱 |
| 9 | 社会活動・貢献 | ボランティア、地域活動、社会課題への取り組み | 🤝 |
| 10 | その他 | 上記に当てはまらない活動 | 📝 |

#### 2.3.2 活動領域の使用

- フレーズごとに複数選択可能（必須）
- ホーム画面でフィルター可能

### 2.4 タグ管理

#### 2.4.1 タグ作成

- フレーズ登録時に新規作成可能
- タグ名の形式：`#` + 任意の文字列

#### 2.4.2 タグ管理画面

- **一覧表示**
  - タグ名
  - 使用件数
  - 活動領域別の使用数
  - ソート：使用数順
  - 検索機能

- **タグ操作**
  - 名前変更
  - 統合（複数タグを1つに統合）
  - 削除

#### 2.4.3 タグ統合

- 統合元タグを選択
- 統合先タグを選択
- 統合実行後、統合元タグは削除される
- 統合元タグを使用していたフレーズは統合先タグに変更

### 2.5 OCR機能

#### 2.5.1 画像アップロード

- 対応形式：JPG, PNG, PDF
- 最大サイズ：10MB

#### 2.5.2 テキスト選択

- 画像上で文字をドラッグ（なぞる）
- なぞった部分をハイライト表示
- OCRでテキストを抽出
- プレビュー表示

#### 2.5.3 複数選択

- [+]ボタンでフレーズ入力欄を追加
- 追加された入力欄がアクティブになる
- 画像で次の箇所をなぞると、アクティブな入力欄にテキストが入る
- 繰り返し可能

### 2.6 外部連携

#### 2.6.1 Amazon書籍情報取得

- Amazon URLからASINを抽出
- Webスクレイピングで以下を取得：
  - タイトル
  - 著者
  - 書籍カバー画像URL
- 取得失敗時は手動入力フォールバック

#### 2.6.2 SNSユーザー情報取得

- 投稿URLからユーザーIDを抽出
- Google検索で「[プラットフォーム] [ユーザーID]」を検索
- 検索結果から「ユーザー名 (@ユーザーID)」のパターンを抽出
- ユーザー名を取得
- 取得失敗時は手動入力フォールバック

---

## 3. 非機能要件

### 3.1 パフォーマンス

- ホーム画面の初回表示：2秒以内
- フレーズ登録：1秒以内（OCR処理を除く）
- OCR処理：画像サイズに依存（目安：5秒以内）
- 検索結果表示：1秒以内

### 3.2 可用性

- 稼働率：99%以上（Supabase, Vercelの稼働率に依存）

### 3.3 セキュリティ

- 認証：Supabase Authによるセキュアな認証
- データアクセス：Row Level Security（RLS）による制御
- パスワード：保存しない（OAuth / Magic Linkのみ）
- API：CORS設定による保護

### 3.4 スケーラビリティ

- ユーザー数：初期100ユーザー、将来的に1,000ユーザーまで対応
- フレーズ数：ユーザーあたり2,000件まで対応
- 無限スクロール：初回50件、追加20件ずつ

### 3.5 保守性

- コードの可読性：TypeScript, ESLint, Prettier使用
- テスト：単体テスト（Vitest）、E2Eテスト（Playwright）
- ドキュメント：README, API仕様書

### 3.6 互換性

- ブラウザ：Chrome, Firefox, Safari, Edge（最新版）
- デバイス：PC, タブレット, スマートフォン
- レスポンシブデザイン対応

---

## 4. 制約条件

### 4.1 技術的制約

- フロントエンド：React (Next.js)
- バックエンド：Supabase (PostgreSQL)
- OCR：Tesseract.js
- デプロイ：Vercel（フロントエンド）

### 4.2 外部サービス制約

- Amazon：Webスクレイピング（利用規約に注意、レート制限対策必須）
- Google検索：SerpAPI（有料）またはスクレイピング（商用注意）
- Supabase：無料プランの制限（500MB DB, 2GB帯域幅/月）

### 4.3 予算制約

- 初期開発：無料サービスの範囲内
- 運用：月額$25以内（Supabase Pro、必要に応じて）

---

## 5. 画面遷移

```
[ログイン画面]
    ↓
[ホーム画面] ←→ [フレーズ登録モーダル]
    ↓
[設定画面] → [タグ管理画面]
```

### 画面一覧

1. ログイン画面（Supabase Authのデフォルト）
2. ホーム画面（メイン）
3. フレーズ登録モーダル
4. 設定画面
5. タグ管理画面

---

## 6. データフロー

### 6.1 フレーズ登録（本）

```
1. ユーザーが[+新規登録]をクリック
2. フレーズ登録モーダルが開く
3. フレーズを入力（テキスト or OCR）
4. 活動領域・タグを選択
5. 出典タイプ「本」を選択
6. Amazon URLを入力
7. [書籍情報を取得]をクリック
8. バックエンドがAmazonをスクレイピング
9. 書籍情報を自動入力
10. [登録する]をクリック
11. データベースに保存
12. ホーム画面に戻る
```

### 6.2 フレーズ登録（SNS）

```
1. ユーザーが[+新規登録]をクリック
2. フレーズ登録モーダルが開く
3. フレーズを入力（テキスト or OCR）
4. 活動領域・タグを選択
5. 出典タイプ「SNS」を選択
6. プラットフォーム（X/Threads）を選択
7. 投稿URLを入力
8. [投稿主の情報を取得]をクリック
9. バックエンドがURLからユーザーID抽出
10. Google検索でユーザー名取得
11. ユーザー情報を自動入力
12. [登録する]をクリック
13. データベースに保存
14. ホーム画面に戻る
```

### 6.3 フレーズ検索・フィルター

```
1. ユーザーがホーム画面でキーワード入力
2. または活動領域・タグをクリック
3. フロントエンドがAPIにリクエスト
4. バックエンドが検索実行
5. 該当するフレーズ（グループ化済み）を返却
6. フロントエンドが表示更新
7. 該当件数を表示
```

### 6.4 CSVエクスポート

```
1. ユーザーが[該当データをCSVでエクスポート]をクリック
2. 現在の検索・フィルター条件でAPIリクエスト
3. バックエンドが該当フレーズを取得
4. CSV形式に変換
5. ダウンロード
```

---

## 7. 優先度

### Phase 1（MVP）- 必須機能

- ✅ ユーザー認証（Supabase Auth）
- ✅ フレーズ登録（テキスト入力）
- ✅ 出典管理（本・SNS・その他）
- ✅ 活動領域・タグ管理
- ✅ ホーム画面（一覧表示）
- ✅ キーワード検索
- ✅ 活動領域・タグフィルター

### Phase 2 - 重要機能

- ✅ OCR機能
- ✅ Amazon書籍情報自動取得
- ✅ SNSユーザー情報自動取得
- ✅ CSVエクスポート
- ✅ タグ管理画面（統合・削除）

### Phase 3 - 拡張機能（将来実装）

- 📝 AI要約機能
- 📝 モバイルアプリ
- 📝 複数ユーザー間でのフレーズ共有
- 📝 ブラウザ拡張機能（ワンクリック登録）

---

## 8. 成功指標（KPI）

### 定量指標

- 登録ユーザー数：100人（3ヶ月）
- 月間アクティブユーザー（MAU）：60人（3ヶ月）
- ユーザーあたりフレーズ登録数：平均50件（3ヶ月）
- 継続率：1ヶ月後40%

### 定性指標

- ユーザーからのフィードバック収集
- 使いやすさ評価：4.0/5.0以上

---

## 9. リスクと対策

| リスク | 影響度 | 対策 |
|--------|--------|------|
| Amazonスクレイピング失敗 | 中 | 手動入力フォールバック、複数スクレイピング手法 |
| Google検索制限 | 中 | SerpAPI利用、キャッシュ活用 |
| OCR精度不足 | 低 | 手動修正機能、画像前処理 |
| Supabase無料枠超過 | 中 | 使用量監視、有料プラン検討 |
| レート制限（外部API） | 中 | リクエスト間隔制御、キャッシュ |

---

## 10. 用語集

| 用語 | 定義 |
|------|------|
| フレーズ | ユーザーが記録する文章・言葉 |
| 活動領域 | フレーズが関連する生活の領域（10種類固定） |
| タグ | フレーズに付与するキーワード（ユーザー定義） |
| 出典 | フレーズの情報源（本・SNS・その他） |
| グループ化 | 書籍またはSNSユーザー単位でフレーズをまとめて表示すること |
| OCR | 画像から文字を抽出する技術 |
| 論理削除 | データを実際には削除せず、削除フラグを立てること |

---

## 11. 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|----------|--------|
| 1.0 | 2024-10-27 | 初版作成 | - |
| 2.0 | 2024-10-27 | 全面改定（活動領域10個、アコーディオンUI、CSVエクスポート等） | - |
