# モーダル枠外クリック無効化

**日付**: 2025年11月14日
**目的**: フレーズ登録モーダルとOCRモーダルで枠外クリック時にモーダルが閉じないように修正
**ステータス**: ✅ 完了

## 背景

### 問題
フレーズ登録モーダルで、ユーザーが入力中に誤って枠外（オーバーレイ部分）をクリックすると、入力内容が失われてモーダルが閉じてしまう問題があった。

### ユーザー体験への影響
- 長い入力内容を誤って消してしまうリスク
- 特にOCRで抽出したテキストが消えると再度画像アップロードから作業をやり直す必要がある
- ユーザーの意図しない操作でデータが失われる

---

## 実装内容

### 修正箇所

**ファイル**: `app/(main)/components/QuoteModal.tsx`

#### 1. フレーズ登録モーダルのオーバーレイ修正

**修正前**（QuoteModal.tsx:408行目）:
```tsx
{/* オーバーレイ */}
<div className="fixed inset-0 bg-gray-900/20 z-40" onClick={onClose} />
```

**修正後**:
```tsx
{/* オーバーレイ */}
<div className="fixed inset-0 bg-gray-900/20 z-40" />
```

**変更内容**: オーバーレイの`onClick={onClose}`を削除

---

#### 2. OCRモーダルのオーバーレイ修正

**修正前**（QuoteModal.tsx:1111-1114行目）:
```tsx
{/* オーバーレイ */}
<div
  className="fixed inset-0 bg-gray-900/30"
  style={{ zIndex: 60 }}
  onClick={handleOCRCancel}
/>
```

**修正後**:
```tsx
{/* オーバーレイ */}
<div
  className="fixed inset-0 bg-gray-900/30"
  style={{ zIndex: 60 }}
/>
```

**変更内容**: オーバーレイの`onClick={handleOCRCancel}`を削除

---

## モーダルを閉じる方法

修正後、以下の方法でのみモーダルを閉じることができます：

### フレーズ登録モーダル
1. **右上のバツ印（×）ボタン** (QuoteModal.tsx:420行目)
2. **下部のキャンセルボタン** (QuoteModal.tsx:1089行目)

### OCRモーダル
- **OCRUploaderまたはOCRCanvasコンポーネント内のキャンセルボタン**

---

## 動作確認

### 確認手順

1. Next.jsフロントエンドを起動（http://localhost:3000）
2. ログイン後、「フレーズを登録」ボタンをクリック
3. モーダルが開いた状態で、枠外（グレーのオーバーレイ部分）をクリック
4. モーダルが閉じないことを確認
5. モーダル内でフレーズを入力
6. 「画像をアップロード」をクリックしてOCRモーダルを開く
7. OCRモーダルの枠外をクリック
8. OCRモーダルが閉じないことを確認
9. 右上のバツ印またはキャンセルボタンでモーダルが正しく閉じることを確認

### 確認結果
✅ すべての確認項目が正常に動作

---

## コード変更の影響範囲

### 変更ファイル
- `app/(main)/components/QuoteModal.tsx` (2箇所修正)

### 影響を受けるコンポーネント
- QuoteModal（フレーズ登録モーダル）
- OCRUploader（OCRアップロードモーダル）
- OCRCanvas（OCR選択モーダル）

### 影響を受けない機能
- モーダル内の入力・選択機能
- バツ印・キャンセルボタンによるモーダルクローズ
- その他の画面・コンポーネント

---

## まとめ

### 達成したこと
✅ フレーズ登録モーダルで枠外クリック時にモーダルが閉じないように修正
✅ OCRモーダルも同様に枠外クリック無効化
✅ ユーザーの誤操作による入力内容の消失を防止
✅ 明示的なクローズ操作（バツ印・キャンセルボタン）のみでモーダルを閉じる仕様に変更

### UX改善の効果
- 入力中の誤クリックでデータが失われるリスクを排除
- OCRで抽出したテキストが意図せず消えることを防止
- より確実なユーザー操作を実現

### 今後の検討事項
- 入力内容がある状態でバツ印・キャンセルボタンを押した際の確認ダイアログ追加の検討
- モーダルクローズ前の保存確認機能の検討（長文入力時など）

---

## 参考リンク
- [React Modal UX Best Practices](https://www.nngroup.com/articles/modal-nonmodal-dialog/)
- [Tailwind CSS Modal Examples](https://tailwindui.com/components/application-ui/overlays/modals)
